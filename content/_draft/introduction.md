---
layout:     post
title:      "Invisibook, 隐私去中心化订单薄"
date:       2025-12-25
author:     "Invisibook Lab"
tags:       ["区块链", "去中心化", "隐私", "订单簿", "DeFi"]
categories: ["Tech"]
---

### 引言：为何需要去中心化隐私订单簿

订单簿交易是现代金融体系中最成熟、最具扩展性的交易形式，也是价格发现与流动性形成的核心机制。然而，在数字化、链上化和高频化的环境下，订单簿暴露出一个长期被忽视的结构性矛盾：**交易系统无法同时实现抗审查、隐私保护与可验证执行。**

### 去中心化订单簿：抗审查与可验证，但缺乏隐私

去中心化交易系统通过将订单提交、排序与撮合规则部署在公开协议之上，消除了对中心化中介的依赖，使交易执行具备天然的抗审查性。只要用户能够与网络交互，其订单就无法被单一实体任意拒绝、冻结或选择性延迟。

更重要的是，链上交易不仅是抗审查的，而且是**可验证的**。撮合规则、成交顺序和结算结果对所有参与者公开，任何人都可以在事后独立验证交易是否按照既定规则执行。这种可验证性在传统交易所中无法实现，是去中心化交易最核心的制度优势之一。

然而，现有去中心化订单簿几乎无一例外地以**完全透明的订单数据**为代价。订单的价格、数量和时间信息被实时广播给所有观察者，使交易行为成为可被持续解析和利用的信号源。这种透明性并非中性，而会在市场微观结构层面引发一系列系统性风险。

### 透明订单簿引发的系统性风险

在完全透明的订单簿中，订单数量直接暴露了交易者的资金规模、执行紧迫性与剩余交易意图。这使得真实交易需求在结构上处于劣势，并诱发以下典型行为：

**价格冲击的提前放大**

一旦市场识别出潜在的大额或持续性订单，流动性提供者会在成交发生之前调整报价结构，通过抬高卖价或压低买价来提前消化预期冲击。结果是滑点在执行前即被放大，真实交易者承担系统性更高的执行成本。

**毒单猎杀与逆向选择**

信息优势参与者可以通过订单簿深度变化识别被动执行或信息劣势的订单流，并将其视为"毒性订单"。通过抢先成交、反向布局或短期对冲，风险被转移给真实需求方，而收益被结构性吸收。这种行为在透明环境中是理性的，并会长期侵蚀真实流动性的参与意愿。

**流动性撤离与深度失效**

当交易意图被识别后，其他流动性会在极短时间内集体撤离，导致表面深度在关键时刻失效。市场在平稳状态下看似充足的流动性，在真实执行需求出现时迅速蒸发，形成内生的不稳定性。

在链上环境中，这些风险被进一步放大。全球无许可的实时可观察性、区块排序权与 MEV 机制，使得上述行为不仅可行，而且可以被制度化和自动化地执行。**去中心化如果缺乏隐私保护，反而可能比传统交易所更不利于真实交易者。**

### 中心化隐私交易：隐私建立在信任与审查之上

中心化交易所通过内部撮合与私有化执行，为部分交易提供了隐私保护，但这种隐私是**不对称且可撤销的**。订单对交易所本身、其基础设施运营方以及潜在的合作机构仍然完全透明。

这意味着：

- 交易所构成天然的审查点，可冻结、拒绝或选择性服务；
- 隐私交易依赖对单一实体的信任，无法被外部独立验证；
- 隐私并非协议保障的权利，而是平台授予的特权。

在这种结构下，交易者必须在执行安全与制度可信性之间做出妥协。

### 去中心化隐私订单簿：解决结构性矛盾

本项目正是为解决上述长期存在的结构性矛盾而提出。我们认为，一个真正健全的交易系统必须同时满足：

- **去中心化执行，以消除审查点；**
- **原生的隐私保护，以防止交易意图被系统性利用；**
- **可验证的撮合与结算规则，以确保市场公平性。**

去中心化隐私订单簿并非对现有交易模式的简单改良，而是在制度层面重新平衡透明性、隐私与可验证性之间的关系。其目标不是隐藏市场本身，而是防止透明性被用作攻击真实交易者的工具。

## Invisibook——隐私去中心化订单薄

### 总流程

1. 用户在本链持有一定数额的加密货币，并且以密文形式记录
2. 用户提交密文订单到链上，并提供zk proof：  
    - 只加密订单的数量，报价是明文的
    - zk proof证明自己有足够的 余额 和 手续费 发起该笔订单
3. 链上根据订单报价按照如下标准进行撮合（订单数额是密文，撮合存在不精确问题）：
    - 区块高度作为时间排序依据，优先在区块号低的订单里面进行价格匹配
    - 若同在一个区块且报价相同，则根据 gas-fee 对订单进行由高到低撮合
    - 根据 限价单↔限价单 与 市价单↔定价单 之间的报价单价匹配
4. 撮合成功之后，链上对这些订单进行锁定，并且让交易双方对该撮合结果进行签名。不许被撤回，只能等待结算。
5. 用户端查看链上撮合结果并在链下与匹配订单的用户用MPC进行点对点结算，并生成zk proof，zk证明以下几点：     
   - 买方入账 / 卖方出账 金额 = 订单结算金额
   - 订单剩余数量 = 旧订单数量 - 结算订单数量
6. 将zk proof上传到链上进行验证，验证通过则修改对应的订单和余额状态（都是密文形式）

### MPC结算

恶意模型下的MPC，进行点对点订单结算

最好采用秘密共享的MPC，参考框架：  
https://github.com/renegade-fi/ark-mpc   
https://github.com/data61/MP-SPDZ   


（混淆电路模式MPC参考，不建议使用：  
https://eprint.iacr.org/2017/030.pdf    
https://github.com/emp-toolkit/emp-ag2pc ）

### Collaborative ZK 证明

参考论文：

1. https://eprint.iacr.org/2025/1388 
2. https://eprint.iacr.org/2024/143 

### 抗MEV协议

当限价单被上传到链上的时候，由于报价是明文，此时存在被MEV攻击的风险，所以我们采用MEVless协议来抗MEV：

- EIP-8099: [https://github.com/ethereum/EIPs/pull/10855](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-8099.md)
- https://github.com/ethereum/RIPs/pull/75

## 共识协议

### 第一阶段：Proof of Buying

第一阶段，我们先使其作为CKB上的Layer2 AppChain运行，所以我们的共识协议需要基于CKB的安全性：

1. **准入共识**：CKB持有者都可以参与挖矿。
2. **出块共识**：矿工需要在CKB Layer1上支付一定数额的CKB到指定地址，并且本地使用VDF算法计算出一个随机值并发布到网络中，每个节点计算 `VDF_output * CKB_payment_amount`，选取最大的那个作为出块节点。VDF的输入为上个区块的 blockHash。
3. **最终共识**：在所有fork中选择 `(VDF_output * CKB_payment_amount)` 总和最大的作为主链。
4. **退出共识**：停止支付或者停止VDF计算即可退出。

### 第二阶段：Proof of Work

（待完善）
